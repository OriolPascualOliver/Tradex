<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FixHub · Planes y precios</title>
  <!--#include "partials/tailwind.html" -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pIVp9sPu0YdHDi3uL1l5X8GZFODdgNpTi27C1l2qCkCmZJLdnOjFkWDXLI4YAlnXrhIR3IuAeGHGZk+y3OC/qw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <meta name="description" content="Elige el plan de FixHub que mejor se adapte a tu equipo. Tarifa Solo para profesionales y plan Team para coordinar cuadrillas." />
</head>
<body>
<!--#include "partials/header.html" -->

<section class="pricing-hero">
  <div class="mx-auto flex max-w-5xl flex-col items-center px-6 py-24 text-center">
    <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl">Planes claros para cada profesional</h1>
    <p class="mt-6 max-w-3xl text-lg text-slate-100/90">Desde una prueba gratuita hasta la gestión completa de tu equipo. Elige el plan que más se ajuste a tu negocio y lleva tu operación al siguiente nivel.</p>
    <div class="billing-toggle-wrap">
      <div class="billing-toggle" role="tablist" aria-label="Periodicidad">
        <button id="btnMonthly" class="active" role="tab" aria-selected="true">Mensual</button>
        <button id="btnYearly" role="tab" aria-selected="false">Anual</button>
        <span class="save-badge">−10%</span>
      </div>
    </div>
  </div>
</section>

<main>
  <section class="pricing-grid">
    <article class="price-card" id="freeCard">
      <span class="badge">Prueba</span>
      <h2 class="text-3xl font-semibold text-ink">Gratis</h2>
      <div class="price"><span id="freePrice">0</span>€ <small id="freePeriod">/ 2 meses</small></div>
      <p class="muted">Accede a las funcionalidades básicas <strong>excepto facturación electrónica</strong> durante 60 días naturales.</p>
      <ul class="features">
        <li>Gestión de trabajos</li>
        <li>Planificación y sincronización</li>
        <li>Presupuestos automáticos en minutos</li>
        <li>Partes con fotos y firma</li>
        <li>Gestión de materiales</li>
        <li>Pago integrado**</li>
        <li class="unavailable">Facturación electrónica</li>
      </ul>
      <div class="card-cta mt-auto">
        <a id="freeBtn" class="btn primary" href="./register.html?planVal=demoM">Empieza gratis</a>
      </div>
      <p class="hint mt-4">* Pago integrado con comisiones del 10% en plan gratuito</p>
    </article>

    <article class="price-card">
      <span class="badge">Autónomos</span>
      <h2 class="text-3xl font-semibold text-ink">Solo</h2>
      <div class="price"><span id="soloPrice">49</span>€ <small id="soloPeriod">/ mes*</small></div>
      <p class="muted">Todas las funcionalidades de FixHub que un profesional necesita.</p>
      <ul class="features">
        <li>Incluye facturación electrónica</li>
        <li>Pago integrado desde la aplicación</li>
        <li>Presupuestos automatizados y fáciles</li>
        <li>Gestión de clientes y materiales</li>
        <li>Soporte estándar</li>
      </ul>
      <div class="card-cta mt-auto">
        <a id="soloBtn" class="btn secondary" href="./register.html?planVal=soloM">Elegir plan Solo</a>
      </div>
      <p class="hint mt-4">* Pago integrado con comisiones del 5%</p>
    </article>

    <article class="price-card" id="teamCard">
      <span class="badge">Empresas</span>
      <h2 class="text-3xl font-semibold text-ink">Team</h2>
      <div class="flex items-center justify-center gap-3 text-sm">
        <label for="teamSize" class="font-semibold">Personas:</label>
        <select id="teamSize" class="input max-w-[140px]">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3" selected>3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8+</option>
        </select>
      </div>
      <div class="price"><span id="teamPriceNum">105</span>€ <small id="teamPeriod">/ mes*</small></div>
      <p class="muted" id="teamNote">Precio por persona: <strong>35€</strong></p>
      <ul class="features">
        <li>Plan Solo completo</li>
        <li>Roles y permisos por equipo</li>
        <li>Agenda compartida y coordinación</li>
        <li>Soporte prioritario</li>
        <li>Próximamente: métricas y SLA</li>
      </ul>
      <div class="card-cta mt-auto">
        <a id="teamBtn" class="btn primary" href="./register.html?planVal=teamM&seats=3">Crear equipo</a>
      </div>
      <p class="hint mt-4">* Pago integrado con comisiones del 5%</p>
    </article>
  </section>

  <div class="mx-auto mt-10 flex justify-center px-6">
    <a href="./features.html" class="btn tertiary">Comparar características <i class="fa-solid fa-arrow-right"></i></a>
  </div>

  <p class="foot-note">* IVA no incluido</p>
</main>

<!--#include "partials/footer.html" -->

<script type="module">
import { pricePerSeatFromTiers, computeAnnual } from '/js/pricing-lib.js';

let PRICING = null;
async function loadPricing(){
  try{
    const res = await fetch('/api-v1/pricing?t=' + Date.now(), {
      headers: { 'Accept': 'application/json' },
      cache: 'no-store'
    });
    if(!res.ok) throw 0;
    PRICING = await res.json();
  }catch(e){
    PRICING = {
      currency:'EUR', vatIncluded:false, annualDiscount:0.10,
      solo:{ monthly:49 },
      team:{ tiers:[
        {maxSeats:1,price:45},{maxSeats:2,price:45},{maxSeats:3,price:35},
        {maxSeats:4,price:33},{maxSeats:5,price:30},{maxSeats:6,price:28},
        {maxSeats:7,price:27},{maxSeats:99,price:27}
      ]}
    };
  }
}

await loadPricing();

const MONTHLY = 'monthly';
const YEARLY  = 'yearly';
let billing = MONTHLY;

const btnMonthly = document.getElementById('btnMonthly');
const btnYearly  = document.getElementById('btnYearly');
const freeCard   = document.getElementById('freeCard');
const freePrice  = document.getElementById('freePrice');
const freePeriod = document.getElementById('freePeriod');
const freeBtn    = document.getElementById('freeBtn');

let soloMonthly = PRICING.solo.monthly;
const soloPriceEl  = document.getElementById('soloPrice');
const soloPeriodEl = document.getElementById('soloPeriod');
const soloBtn      = document.getElementById('soloBtn');

const teamSizeEl   = document.getElementById('teamSize');
const teamPriceNum = document.getElementById('teamPriceNum');
const teamPeriodEl = document.getElementById('teamPeriod');
const teamNoteEl   = document.getElementById('teamNote');
const teamBtn      = document.getElementById('teamBtn');

function perSeatPrice(n){
  return pricePerSeatFromTiers(n, PRICING.team.tiers);
}

function yearlyTotal(monthly){ return computeAnnual(monthly, PRICING.annualDiscount).yearly }
function fmt(n){ const v = Number(n); return (v%1===0)? v.toString() : v.toFixed(2).replace('.', ',') }

function updateFree(){
  if (billing === MONTHLY){
    freeCard.classList.remove('opacity-50', 'pointer-events-none');
    freePrice.textContent = '0';
    freePeriod.textContent = '/ 2 meses';
    freeBtn.textContent = 'Empieza gratis';
    freeBtn.setAttribute('href','./register.html?planVal=demoM');
  } else {
    freeCard.classList.add('opacity-50', 'pointer-events-none');
    freePrice.textContent = '—';
    freePeriod.textContent = '/ no disponible';
    freeBtn.textContent = 'No disponible en anual';
    freeBtn.removeAttribute('href');
  }
}

function updateSolo(){
  const suf = billing === YEARLY ? 'A' : 'M';
  if (billing === MONTHLY){
    soloPriceEl.textContent = fmt(soloMonthly);
    soloPeriodEl.textContent = '/ mes*';
  } else {
    soloPriceEl.textContent = fmt(yearlyTotal(soloMonthly));
    soloPeriodEl.textContent = '/ año*';
  }
  soloBtn.setAttribute('href', `./register.html?planVal=solo${suf}`);
}

function updateTeam(){
  const n = parseInt(teamSizeEl.value,10);
  const seat = perSeatPrice(n);
  const mTotal = n * seat;

  const suf = billing === YEARLY ? 'A' : 'M';
  if (billing === MONTHLY){
    teamPriceNum.textContent = fmt(mTotal);
    teamPeriodEl.textContent = '/ mes*';
    teamNoteEl.innerHTML = 'Precio por persona: <strong>'+fmt(seat)+'€</strong>';
  } else {
    const { yearly } = computeAnnual(mTotal, PRICING.annualDiscount);
    teamPriceNum.textContent = fmt(yearly);
    teamPeriodEl.textContent = '/ año*';
    teamNoteEl.innerHTML = 'Equivale a <strong>'+fmt(seat*(1-PRICING.annualDiscount))+'€</strong> / persona / mes (−'+(PRICING.annualDiscount*100)+'% anual).';
  }
  teamBtn.setAttribute('href', `./register.html?planVal=team${suf}&seats=${n}`);
}

function setBilling(mode){
  billing = mode;
  btnMonthly.classList.toggle('active', billing===MONTHLY);
  btnMonthly.setAttribute('aria-selected', billing===MONTHLY);
  btnYearly.classList.toggle('active', billing===YEARLY);
  btnYearly.setAttribute('aria-selected', billing===YEARLY);

  updateFree();
  updateSolo();
  updateTeam();
}

btnMonthly.addEventListener('click', () => setBilling(MONTHLY));
btnYearly .addEventListener('click', () => setBilling(YEARLY));
teamSizeEl.addEventListener('change', updateTeam);

setBilling(MONTHLY);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FixHub · Contacto</title>
  <!--#include "partials/tailwind.html" -->
</head>
<body>
  <!--#include "partials/header.html" -->

  <main class="page-container">
    <header class="flex flex-col items-center gap-4 text-center">
      <h1 class="section-heading">¡Hablemos! ¿Necesitas ayuda?</h1>
      <p class="section-subheading">En FixHub estamos para ayudarte. Escríbenos si tienes dudas, sugerencias o quieres conocer mejor la plataforma.</p>
      <p class="muted">También puedes escribir a <a class="text-sky-600" href="mailto:opotek+fixhub@protonmail.com">opotek+fixhub@protonmail.com</a>.</p>
    </header>

    <form class="contact-form" id="contactForm">
      <label for="name">Nombre y apellidos *</label>
      <input id="name" name="name" class="input" required />

      <label for="company">Empresa</label>
      <input id="company" name="company" class="input" />

      <label for="email">Email *</label>
      <input id="email" type="email" name="email" class="input" required />

      <label for="phone">Teléfono</label>
      <input id="phone" name="phone" class="input" />

      <label for="interest">Interés principal</label>
      <input id="interest" name="interest" class="input" placeholder="Planificación, presupuestos, materiales…" />

      <label for="msg">Mensaje</label>
      <textarea id="msg" name="msg" class="input" placeholder="Cuéntanos tu flujo de trabajo actual y qué te gustaría simplificar" required></textarea>

      <button type="submit" class="btn primary self-start">Enviar</button>
      <p class="hint">* Campos obligatorios</p>
      <p id="formStatus" class="muted" aria-live="polite"></p>
    </form>
  </main>

  <!--#include "partials/footer.html" -->

  <script src="/js/apiClient.js"></script>
  <script>
    const form = document.getElementById('contactForm');
    const status = document.getElementById('formStatus');

    function ensureDeviceId(){
      if (!localStorage.getItem('deviceId')){
        const newId = self.crypto?.randomUUID ? self.crypto.randomUUID() : Math.random().toString(36).slice(2);
        localStorage.setItem('deviceId', newId);
      }
      return localStorage.getItem('deviceId');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.textContent = '';
      ensureDeviceId();
      const data = {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        message: document.getElementById('msg').value.trim(),
        other: {
          company: document.getElementById('company').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          interest: document.getElementById('interest').value.trim(),
        }
      };
      try {
        await apiClient.post('contact', data);
        status.style.color = '#16a34a';
        status.textContent = 'Mensaje enviado correctamente.';
        form.reset();
      } catch (err) {
        status.style.color = '#dc2626';
        status.textContent = err.message || 'No se pudo enviar el mensaje.';
      }
    });
  </script>
</body>
</html>

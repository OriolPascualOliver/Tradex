server {
  listen 80;
  server_name _;

  # Pages root (served HTML)
  root /usr/share/nginx/site/pages;
  index index.html;

  # Enable SSI for partials in /partials/*
  ssi on;
  ssi_types text/html;

  # Pretty URLs
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Static assets from the separate mount
  location /public/ {
    alias /usr/share/nginx/site/public/;
  }
  # Backwards-compat for pages that still reference /css, /js, /images:
  location /css/    { alias /usr/share/nginx/site/public/css/; }
  location /js/     { alias /usr/share/nginx/site/public/js/; }
  location /images/ { alias /usr/share/nginx/site/public/images/; }

  # Your only API prefix
  location /api-v1/ {
    proxy_pass         http://api:8000/api-v1/;
    proxy_http_version 1.1;
    proxy_set_header   Host $host;
    proxy_set_header   X-Real-IP $remote_addr;
    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto $scheme;
  }
}

